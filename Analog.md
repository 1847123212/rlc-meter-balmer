# Аналоговая часть схемы. #

![http://wiki.rlc-meter-balmer.googlecode.com/hg/images/circuit/analog.png](http://wiki.rlc-meter-balmer.googlecode.com/hg/images/circuit/analog.png)

[Схема в pdf](http://rlc-meter-balmer.googlecode.com/hg/circuit/analog3.pdf)

Аналоговая часть построенна по класическому рецепту для RLC измерителей. Сигнал от DAC поступает на пин GENERATOR. После этого стоит ФНЧ на [R2](https://code.google.com/p/rlc-meter-balmer/source/detail?r=2) C2 300 КГц, или на [R2](https://code.google.com/p/rlc-meter-balmer/source/detail?r=2) C7 3 КГц. В качестве "твердотельного реле" используем SN74LVC1G3157DBVR. IC1 - обычный повторитель для умощнения сигнала. К коннектору X1 подключаются щупы Кельвина. На IC2/IC3 построен I/V конвертор по классической схеме. IC4/IC5 - инструментальные усилители с КУ=3.74. Далее идут разделительные конденсаторы С10, С14. Небольшой коэффициэнт усиления в инструментальных усилителях и разделительные конденсаторы сразу после них позволяют избавиться от проблемы (в моем случае исключительно теоретической) с небольшим постоянным напряжением между щупами X1-2, X1-3. Даже если предположить, что разница будет аж целый 1 мВ (в реальности она меньше), то этот 1 мВ всеголишь услилится в 3.74 раза и никакого влияния не окажет на стабильность работы схемы. Далее идет ФНЧ на резисторах [R1](https://code.google.com/p/rlc-meter-balmer/source/detail?r=1) C15 и [R3](https://code.google.com/p/rlc-meter-balmer/source/detail?r=3) C13. Эти ФНЧ введены уже по результатам экпериментов, так как без них при максимальном коэффициэнте усиления схема банально принимает радиостанции средневолнового диапазона. Далее идут U$2, U$4 - усилители с программируемым коэффициэнтом усиления от 1x до 32x. Так что общее усиление тракта изменяется от 3.74 до 119 - этого вполне хватает, чтобы перекрыть диапазон сопротивлений от 1 мОм до 100 МОм.

На IC6, IC7 - организованна "виртуальная земля". Достаточно сложная конструкция нужна для того, чтобы избежать проникновения сигнала между каналами, а также проникновения сигналов из оконечных каскадов к начальным. Причин тому несколько, например проникновение даже 10 мкВ сгинала на положительный вход IC3 в I/V конверторе очень сильно повлияет на измерение больших сопротивлений и малых емкостей. На выходе каждой из "виртуальных земель" на IC6, IC7 стоии "snubber network". Специальная система подавляющая колебания из-за нестабильности нагрузки. И это действительно важно, особенно для питания PGA U$2, U$4. Дело в том, что в MCP6S21 стоит достаточно низкоомный резистор в системе обратной свызи (5 КОм примерно), это позволяет данному усилителю иметь достаточно точный КУ на высоких частотах, но создает дополнительную нагрузку на "виртуальную землю".

Все резисторы с точностью 1%. Скорее всего будет работать и с 5%-ми резисторами, но я не проверял. Потому как купил пак 1%-х резисторов и пользуюсь им. С 1%-ми резисторами кстати сразу получается точность измерения порядка 1% на частотах 100 Гц-5 КГц. На более высоких частотах без калибровки щупов обойтись нельзя.

# Плюсы. #

Отдельные каскады усиления позволили сделать достаточно низкую емкость между щупами X1. 2 pF внутрисхемно и еще примерно 1-2 pF на щупах. Каскады имеют стабильное усиление до частоты 375 КГц.

# Минусы. #

I/V конвертор на IC2/IC3 оказался ограничителем по максимальной частоте. На частоте 180 КГц он работает стабильно. На частоте 375 КГц он уже начинает работать очень нелинейно, особенно с резисторами высокого сопротивления.

Всем усиливающим ОУ необходимо работать в линейном режиме. Rail-to-Rail сразу добавляет 2% ошибки к определению фазы сигнала. Поэтому до ADC доходит сигнал в интервале 2700-3700 (2.17 В - 2.98 В). Для точности оказалось - лучше пожертвовать точностью ADC, чем заходить в Rail-to-Rail область усиления.

12 bit DAC на низких частотах недостаточно. Из-за этого есть дополнительная ошибка в фазе на частотах ниже 1 КГц. Из-за этого частоту порядка 10 Гц не получится использовать. Надо будет ввести еще один ФНЧ с частотой среза порядка 100 Гц.